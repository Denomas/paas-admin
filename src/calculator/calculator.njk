{% extends "../layouts/govuk.njk" %}
{% from "@govuk-frontend/frontend/components/button/macro.njk" import govukButton %}
{% from "@govuk-frontend/frontend/components/input/macro.njk" import govukInput %}
{% from "@govuk-frontend/frontend/components/radios/macro.njk" import govukRadios %}

{% block page_title %}
  Pricing calculator
{% endblock %}

{% block main %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-one-half">
      <h1 class="paas-heading-l">Estimate your monthly costs</h1>

      <p>
        Service teams usually run 3 environments, such as:<br>
        Production, Integration and Staging.
      </p>

      <p>
        <strong>You can add multiple environments to your cost estimate.</strong>
      </p>
    </div>
  </div>

  <form class="govuk-grid-row" method="get">
    <input type="hidden" name="estimate" value="{{ estimate | dump }}">

    <div class="govuk-grid-column-two-thirds">
      <details open>
        <summary>Calculate memory usage</summary>

        <div class="govuk-grid-row">
          <div class="govuk-grid-column-two-thirds">
            {{ govukInput({
              label: {
                text: "App description"
              },
              id: "app-description",
              name: "app[description]"
            }) }}
          </div>

          <div class="govuk-grid-column-one-third">
            <div class="govuk-grid-column-one-half">
              {{ govukInput({
                label: {
                  text: "Memory"
                },
                id: "app-memory",
                name: "app[memory]"
              }) }}
            </div>

            <div class="govuk-grid-column-one-half">
              {{ govukInput({
                label: {
                  text: "Instances"
                },
                id: "app-instances",
                name: "app[instances]"
              }) }}
            </div>
          </div>
        </div>

        {{ govukButton({
          text: "Add application"
        }) }}

        <blockquote>
          <p>
            Compute charged by the Gigabyte-hour, on a pay-as-you-go basis. All usage rounded up to the nearest hour.
          </p>

          <p>
            Load-balancing provided by the platform and included in price. Up to 10 GB/month bandwidth free. Multiple app instances are automatically balanced across availability zones.
          </p>
        </blockquote>
      </details>

      {% for service, plans in services %}
        <details>
          <summary>{{ service }}</summary>

          {{ govukRadios({
            idPrefix: service,
            name: service + "[plan]",
            classes: "govuk-radios--inline",
            fieldset: {
              legendText: "Choose a plan"
            },
            items: plans | query("[].{text: name, value: planGUID}")
          }) }}

          {{ govukButton({
            text: "Add service"
          }) }}
        </details>
      {% endfor %}
    </div>

    <div class="govuk-grid-column-one-third">
      <h4>Estimated cost summary</h4>

      <p>
        <em>Following prices are <strong>excluding vat</strong>.</em>
      </p>

      <ul>
        {% for quote in quota.instances %}
          <li>
            {{ quote.resourceType }} - {{ quote.resourceName }}: {{ quote.price.exVAT | currency(2) }}
            <button type="submit" name="remove[]" value="{{ quote.resourceGUID }}">remove</button>
          </li>
        {% endfor %}
      </ul>
      
      <p>Total estimated cost:</p>

      £{{ quota.exVAT | currency(2) }} per month

      <details>
        <summary>Why this cost might vary</summary>

        <p>This estimate assumes constant usage at the levels you've provided. Final figures will vary as CPU/Postgres/ MySQL are charged based on hourly consumption and exchange rates will fluctuate.</p>

        <p>This cost estimate is dated: 26.01.2017 – 15:23. Estimates are liable to change over time.</p>
      </details>
    </div>
  </form>

  {{ params | dump }}

{% endblock %}
