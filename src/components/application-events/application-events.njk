{% extends "../applications/_tabs.njk" %}

{% block pageTitle %}
  {{ application.entity.name }} - Application Events
{% endblock %}

{% block insideTabs %}
  <p class="govuk-body">
    Displaying page {{ page }} of {{ pagination.total_pages }},
    there are {{ pagination.total_results }} total events.
  </p>

  <p class="govuk-body">

    {% if pagination.total_pages > 1 %}
      {% if page <= 1 %}
        <a class="govuk-link" disabled>Previous page</a>
      {% else %}
        <a class="govuk-link" href="{{
          linkTo(
            'admin.organizations.spaces.applications.events.view',
            {organizationGUID: organization.metadata.guid, spaceGUID: space.metadata.guid, applicationGUID: application.metadata.guid, page: page-1}
          ) }}">Previous page</a>
      {% endif %}

      {% if pagination.next %}
        <a class="govuk-link" href="{{
          linkTo(
            'admin.organizations.spaces.applications.events.view',
            {organizationGUID: organization.metadata.guid, spaceGUID: space.metadata.guid, applicationGUID: application.metadata.guid, page: page+1}
          ) }}">Next page</a>
      {% else %}
        <a class="govuk-link" disabled>Next page</a>
      {% endif %}
    {% endif %}
  </p>

  {% if events.length > 0 %}
    <table class="govuk-table">
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th class="govuk-table__header">Date</th>
          <th class="govuk-table__header">Actor</th>
          <th class="govuk-table__header">Event</th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
      {% for event in events %}
        <tr class="govuk-table__row">
          <td class="govuk-table__cell">
            {{ event.updated_at | nicedate }}
            {{ event.updated_at | nicetime }}
          </td>
          <td class="govuk-table__cell">
            {% if event.actor.name %}
              {{ event.actor.name }}
            {% else %}
              <code>{{ event.actor.guid }}</code>
            {% endif %}
          </td>
          <td class="govuk-table__cell">
            {% if eventTypeDescriptions[event.type] %}
              {{ eventTypeDescriptions[event.type] }}
            {% else %}
              <code>{{ event.type }}</code>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  {% endif %}

{% endblock %}
