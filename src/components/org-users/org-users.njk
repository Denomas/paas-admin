{% extends "../../layouts/govuk.njk" %}
{% from "govuk-frontend/govuk/components/button/macro.njk" import govukButton %}
{% from "govuk-frontend/govuk/components/details/macro.njk" import govukDetails %}

{% block pageTitle %}
  Team members
{% endblock %}

{% block content %}
  {{ super() }}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-l">
      Team members
    </h1>

    <p class="govuk-body">
      Organisation level users can manage and/or view information regarding user accounts, billing,
      resource quota for the organisation and spaces. To edit a member's role go to their profile page.
    </p>
  </div>

  <div class="govuk-grid-column-one-third text-right">
    {% if isAdmin or isManager %}
      {{ govukButton({
        text: "Invite a new member",
        href: linkTo('admin.organizations.users.invite', {organizationGUID: organization.metadata.guid})
      }) }}
    {% endif %}
  </div>

  <div class="govuk-grid-column-full">
    <details class="govuk-details" role="group">
      <summary class="govuk-details__summary" role="button" aria-controls="details-content-0" aria-expanded="false">
        <span class="govuk-details__summary-text">
          What can these roles do?
        </span>
      </summary>

      <div class="govuk-details__text" aria-hidden="true">
        <p class="govuk-body">
          <span class="govuk-!-font-weight-bold">
            Org managers
          </span>
          are users who can create and delete spaces within an org, and
          administer user roles, both within the org and its spaces.  We
          recommend to have at least two org managers.
        </p>

        <p class="govuk-body">
          <span class="govuk-!-font-weight-bold">
            Org auditors
          </span>
          are users who can view quota allocation and user roles across the
          org. Auditors can't change any of these configurations.
        </p>

        <p class="govuk-body">
          <span class="govuk-!-font-weight-bold">
            Org billing managers
          </span>
          are users who can see billing, costs and quota information.
        </p>

        <p class="govuk-body">
          Tasks related to spaces are associated with space-level roles.
        </p>
      </div>
    </details>
  </div>
</div>

<table class="govuk-table user-list">
  <thead class="govuk-table__head">
    <tr class="govuk-table__row">
      <th class="govuk-table__header name" scope="col">Email address</th>
      <th class="govuk-table__header authentication" scope="col">
        {% if isAdmin or isManager %}
          Authentication
        {% endif %}
      </th>
      <th class="govuk-table__header is-org-manager" scope="col">Org manager</th>
      <th class="govuk-table__header is-billing-manager" scope="col">Org billing manager</th>
      <th class="govuk-table__header is-org-auditor" scope="col">Org auditor</th>
      <th class="govuk-table__header spaces" scope="col">Spaces assigned or can access</th>
    </tr>
  </thead>
  <tbody class="govuk-table__body">
    {% for guid, user in users %}
    <tr class="govuk-table__row">
      <td class="govuk-table__cell">
        {% if isAdmin or isManager %}
          <a href="{{ linkTo('admin.organizations.users.edit', {organizationGUID: organization.metadata.guid, userGUID: guid}) }}" class="govuk-link">
            {{ user.username }}
          </a>
        {% else %}
          {{ user.username }}
        {% endif%}
      </td>
      <td class="govuk-table__cell">
        {% if isAdmin or isManager %}
          {% if userOriginMapping[guid] == 'uaa' %}
            Password
          {% else %}
            {{ userOriginMapping[guid] | capitalize }}
          {% endif %}
        {% endif %}
      </td>
      <td class="govuk-table__cell">
        {% if 'org_manager' in user.orgRoles %}
          <img class="tick" alt="Yes" src="./tick.png">
        {% endif %}
      </td>
      <td class="govuk-table__cell">
        {% if 'billing_manager' in user.orgRoles %}
          <img class="tick" alt="Yes" src="./tick.png">
        {% endif %}
      </td>
      <td class="govuk-table__cell">
        {% if 'org_auditor' in user.orgRoles %}
          <img class="tick" alt="Yes" src="./tick.png">
        {% endif %}
      </td>
      <td class="govuk-table__cell">
        <ul class="plain">
          {% for space in user.spaces %}
            <li>
              <a href="{{ linkTo('admin.organizations.spaces.applications.list', {organizationGUID: organization.metadata.guid, spaceGUID: space.metadata.guid}) }}"
                class="govuk-link">
                {{ space.entity.name }}
              </a>
            </li>
          {% endfor %}
        </ul>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
